extends main
include mixins/pagination
include mixins/blogpost

block content
	div#main.round_8.clearfix
		div.page_title.round_6
			h1.replace
				a(href='/blog/#{blogdata.id}') Blog: #{blogdata.name}
		div#postdiv(style="float:right;margin-right:20px")
			if canedit
				a(do="avatar",href="#"): img(src="#{blogdata['140x140']}",width="140px",height="140px")
				h5
					a(href="/blog/#{blogdata.id}/newpost",style="text-decoration:underline") Submit Post
				div#dialog-message(title="Change Avatar",style="display:none")
					p.
						Drag a new avatar image anywhere on this page.
			else
				a: img(src="#{blogdata['140x140']}",width="140px",height="140px")
		div#content.left
			each post in posts
				+blogpost(post, canedit)
				hr

		div.clear
		+pagebar(curpage, lastpage, '/blog/' + blogdata.id + '/%')

block subs
	+sub("delete", function(obj) {
		if (confirm("Are you sure you'd like to delete this post?")) {
			getPage("/post/" + $(obj).attr('quib-id') + "/delete", {});
		}
		return false;
	})
	+sub("edit", function(obj) {
		$("#post_" + $(obj).attr('quib-id') + " .bbcode").css('display', 'none');
		$("#post_" + $(obj).attr('quib-id') + " form").css('display', 'block');
		$("#post_" + $(obj).attr('quib-id') + " textarea").sceditor({
			plugins: "bbcode",
			style: "/css/default.min.css",
			toolbar: "bold,italic,underline,strike|left,center,right|size,color,removeformat|orderedlist,bulletlist,code,quote|image,link,youtube,source"
		});
		return false;
	})
	+sub("cancel", function(obj) {
		obj = $(obj).closest('form');
		$("#post_" + $(obj).attr('quib-id') + " .bbcode").css('display', 'block');
		$("#post_" + $(obj).attr('quib-id') + " form").css('display', 'none');
	})
	+sub("avatar", function(obj) {
		$("#dialog-message").dialog({
			draggable: false,
			modal: true,
			buttons: {
					Cancel: function() {
						$(this).dialog("close");
					}
			}
		});
		return false;
	})